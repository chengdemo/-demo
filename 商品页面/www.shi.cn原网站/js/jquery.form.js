var Dialog = {}; function ShowDialog(options, callbackOk) { var css = 'black'; if ($("#_diawindow").length > 0) { $("#_diawindow").remove() } if ($("#_markdiag").length > 0) { $("#_markdiag").remove() }; var opts = $.extend({}, { Width: "", Height: "", Title: "", FrameURL: "", ContentFlag: "0", Contents: "" }, options); var skinurl = '/Common/Dialog/' + css + '/dialog.png'; var skinurl2 = '/Common/Dialog/' + css + '/dialogover.png'; if (!$("#_diawindow").length > 0) { var maktemp = '<div id="_markdiag" class="hidediv"></div>'; var tempstr = ''; if (opts.ContentFlag == '0') { tempstr = '<div class="pop_dialog" id="_diawindow"><div class="pop_dialog-title"><div class="pop_dialog-left">' + opts.Title + '</div><div class="fr pop_dialog-title-close"><img src="' + skinurl + '"  id="_diagclose"/></div></div><div class="pop_dialog-content p15"><table  border="0" cellpadding="0" cellspacing="0" style="width:' + (opts.Width) + 'px;height:' + (opts.Height) + 'px"><tr><td><div id="dialogdivloading">正在加载请稍后...</div><iframe src="' + opts.FrameURL + '" scrolling="auto" style="z-index:-1;height:' + (opts.Height) + 'px;display:none;width:100%;" scrolling="auto" frameborder="0" id="_markdiagiframe"></iframe></td></tr></table></div></div>' } else if (opts.ContentFlag == '1') { tempstr = '<div class="pop_dialog" id="_diawindow"><div class="pop_dialog-title"><div class="pop_dialog-left">' + opts.Title + '</div><div class="fr pop_dialog-title-close"><img src="' + skinurl + '"  id="_diagclose" /></div></div><div class="pop_dialog-content p15"><table style="width:' + (opts.Width) + 'px;height:' + (opts.Height) + 'px"><tr><td style="width:32%;height:52px;"><img src="/Common/Dialog/blue/' + opts.FrameURL + '\" width="34px" height="34px" align="absmiddle"/></td><td align="left">' + opts.Contents + '</td></tr><tr><td align="right" colspan="2"><div class="trborder"><span class="task_newbotton"><a href="javascript:" id="_btDialogOK" name="_btDialogOK">确定</a></span></div></td></tr></table></div></div>' } else if (opts.ContentFlag == '2') { tempstr = '<div class="pop_dialog" id="_diawindow"><div class="pop_dialog-title"><div class="pop_dialog-left">' + opts.Title + '</div><div class="fr pop_dialog-title-close"><img src="' + skinurl + '"  id="_diagclose" /></div></div><div class="pop_dialog-content p15"><table style="width:' + (opts.Width) + 'px;height:' + (opts.Height) + 'px"><tr><td style="height:52px;">' + opts.Contents + '</td></tr><tr><td><div class="trborder"><span class="task_newbotton"><a href="javascript:" id="_btDialogOK" name="_btDialogOK">确定</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:" id="_aclose" name="_aclose">取消</a></span></div></td></tr></table></div></div>' } else if (opts.ContentFlag == '3') { tempstr = '<div class="pop_dialog" id="_diawindow"><div class="pop_dialog-title"><div class="pop_dialog-left">' + opts.Title + '</div><div class="fr pop_dialog-title-close"><img src="' + skinurl + '"  id="_diagclose" class="inner" /></div></div><div class="pop_dialog-content p15"><table style="width:' + (opts.Width) + 'px;height:' + (opts.Height) + 'px"><tr><td style="height:52px;">' + opts.Contents + '</td></tr></table></div></div>' } $("body").append(maktemp); $("body").append(tempstr); drag('.pop_dialog') } else { $("#_markdiag").show(); $("#_markdiag").show() } var iframe = document.getElementById('_markdiagiframe'); if (iframe) { var iframewindow = document.getElementById('_markdiagiframe').contentWindow; if (iframe.attachEvent) { iframe.attachEvent("onload", function () { $('#dialogdivloading').hide(); $('#_markdiagiframe').show(); iframewindow.focus() }) } else { iframe.onload = function () { $('#dialogdivloading').hide(); $('#_markdiagiframe').show(); iframewindow.focus() } } } if (callbackOk) { $('#_btDialogOK').click(function () { if ($("#_diawindow").length > 0) { $("#_diawindow").remove() } if ($("#_markdiag").length > 0) { $("#_markdiag").remove() }; callbackOk() }) } else { $('#_btDialogOK').click(function () { if ($("#_diawindow").length > 0) { $("#_diawindow").remove() } if ($("#_markdiag").length > 0) { $("#_markdiag").remove() } }) } var w, h, de; de = document.documentElement; w = self.innerWidth || (de && de.clientWidth) || document.body.clientWidth; h = self.innerHeight || (de && de.clientHeight) || document.body.clientHeight; var diagtop = h / 2 - (opts.Height / 2) + eval($(document).scrollTop()); diagtop = diagtop - 40; var diagleft = w / 2 - (opts.Width / 2) + eval($(document).scrollLeft()); $("#dialogdivloading").css({ "top": diagtop, "left": diagleft, "width": (opts.Width), "height": (opts.Height) }); $("#_diawindow").css({ "top": diagtop, "left": diagleft, "width": (opts.Width + 12) }); $(window).scroll(function () { var diagtop = h / 2 - (opts.Height / 2) + eval($(document).scrollTop()); var diagleft = w / 2 - (opts.Width / 2) + eval($(document).scrollLeft()); $("#_diawindow").css({ "top": diagtop, "left": diagleft }) }); $("#_aclose").click(function () { if ($("#_diawindow").length > 0) { $("#_diawindow").remove() } if ($("#_markdiag").length > 0) { $("#_markdiag").remove() } }); $("#_diagclose").mousemove(function () { $(this).attr("src", skinurl2) }).mouseout(function () { $(this).attr("src", skinurl) }).click(function () { Close() }); if (opts.ContentFlag == '0') { if (navigator.userAgent.indexOf("MSIE") > 0) { _markdiagiframe.location.href = opts.FrameURL; $('#dialogdivloading').hide(); $('#_markdiagiframe').show() } } }; function Close() { if ($("#_diawindow").length > 0) { $("#_diawindow").remove() } if ($("#_markdiag").length > 0) { $("#_markdiag").remove() } }; function PostData(form, act) { var url = location.href.replace(/\#/g, ''); if (url.indexOf('?') > -1) { url += '&act=post' } else { url += '?act=post' } if ($.trim(act) != '') { url = url.replace('post', act) } if ($('#downloadcsv').length <= 0) { $('body').append("<iframe id=\"downloadcsv\" name=\"downloadcsv\" style=\"display:none\"></iframe>") } document.forms[form].target = 'downloadcsv'; document.forms[form].action = url; document.forms[form].submit() }; function setValue(msg, flag, url) { if (msg != '') { Dialog.Tip(msg, flag, function () { if (url != '') { if (parent.window.top == parent.window.self) { location.href = url } else { parent.location.href = url } } }) } }; function setMsg(msg, flag, url) { Dialog.Tip(msg, flag, function () { location.href = url }) }; Dialog.Confirm = function (message, callback) { ShowDialog({ Width: 250, Height: 100, Title: "确认提示", FrameURL: '', ContentFlag: "2", Contents: message }, callback) }; Dialog.Tip = function (message, tiptype, callback) { var imgName = "worn.gif"/*tpa=http://www.shi.cn/js/worn.gif*/; switch (tiptype) { case '0': imgName = "worn.gif"/*tpa=http://www.shi.cn/js/worn.gif*/; break; case '1': imgName = "right.gif"/*tpa=http://www.shi.cn/js/right.gif*/; break; case '-1': imgName = "error.gif"/*tpa=http://www.shi.cn/js/error.gif*/; break } ShowDialog({ Width: 250, Height: 100, Title: "温馨提示", FrameURL: imgName, ContentFlag: "1", Contents: message }, callback) }; Dialog.Show = function (title, width, height, url, callback) { ShowDialog({ Width: width, Height: height, Title: title, FrameURL: url, ContentFlag: "0", Contents: "<div>框架内页内容</div>" }, callback) }; Dialog.Close = function () { if ($("#_diawindow").length > 0) { $("#_diawindow").remove() } if ($("#_markdiag").length > 0) { $("#_markdiag").remove() } }; Dialog.Float = function (title, width, height, content, callback) { ShowDialog({ Width: width, Height: height, Title: title, FrameURL: '', ContentFlag: "3", Contents: content }, callback) }; function drag(me) { function mdown(e) { $(me).css({ 'cursor': 'move' }); var offset = $(me).offset(); var x = e.pageX - offset.left; var y = e.pageY - offset.top; $(document).bind('mousemove', function (ev) { var _x = ev.pageX - x; var _y = ev.pageY - y; $(me).css({ 'left': _x + 'px', 'top': _y + 'px' }) }) } $(me).mousedown(function (e) { mdown(e) }); $(document).mouseup(function () { $(me).css({ 'cursor': 'default' }); $(this).unbind('mousemove') }) }; function comdel(id) { $('#txtid').val(id); Dialog.Confirm('确定要删除吗？', function () { PostData('form1') }) }; function comdel(id, act, msg) { $('#txtid').val(id); Dialog.Confirm(msg, function () { PostData('form1', act) }) }; function AjaxPost(url, frm, callback) { var jdata = $('#' + frm).serialize(); $.ajax({ type: "POST", url: url, data: jdata, async: true, error: function (request) { Dialog.Tip('出错了!', '-1') }, success: function (data) { var r = JSON.parse(data); if (r.msg == '') { if (r.url != null && r.url != '') { if (r.parent) { parent.location.href = r.url } else { location.href = r.url } } if (callback != null) { callback() } } else { Dialog.Tip(r.msg, r.succ ? '1' : '-1', function () { if (r.url != null && r.url != '') { if (r.parent) { parent.location.href = r.url } else { location.href = r.url } } if (callback != null) { callback() } }) } } }) } function AjaxGet(url, panel, callback) { $.get(url, { __AjaxPanelIDs: panel }, function (content, textStatus) { if (textStatus != "success") { Dialog.Tip('出错了!', '-1') } else { $('#' + panel).html($.trim(content)); if (callback != null) { callback(content) } } }) } function AjaxDel(key, msg, act, frm) { $('#txtid').val(key); Dialog.Confirm(msg, function () { var url = location.href; url = url.substring(url.indexOf('/') + 2); url = url.substring(url.indexOf('/')); url = url + '?act=' + act; AjaxPost(url, frm) }) };